<!DOCTYPE html>
<html lang='en'>
<head>
	<meta charset="UTF-8">
	<title>WurmTerm</title>
	<link rel="stylesheet" type='text/css' href='css/styles.css'/>
	<link rel="stylesheet" type='text/css' href='node_modules/starboard-notebook/dist/starboard-notebook.css'/>

	<link rel="manifest" href="manifest.json">
	<meta name="theme-color" content="white"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
	<div id='menu'>
		<span class='title'>üêõ WurmTerm</span>
		[ <a data-view='main'>Home</a> ]
		[ <a data-view='notebook'>Notebook</a> ]
		[ <a data-view='settings'>Settings</a> ]
	</div>
	
	<div class='main' id='info'>
	</div>

	<div class='main' id='main'>
		<div id='visualContainer'>
			Visualization
			<select id='renderer'>
				<option value='netmap'>netmap</option>
				<option value='perfFlameGraph'>perf flamegraph</option>
			</select>
			Host
			<span id='visualizedHost'></span>
			<div id='visual'>
			</div>
		</div>
		<div id='nodes'>
		</div>
		<div id='footer'>
			<div class='title'>Your SSH History (click to connect)</div>
			<ul id='history'>
			</ul>
			<form id='hostForm'>
				Or enter hostname:<br/>
				<input id='hostEntry' type='text'/>
				<input type='submit' value='Connect'/>
			</form>
		</div>
	</div>

	<div class='main' id='notebook'>
		Host <input type='text' id='notebook-host' list='notebook-hosts' placeholder='localhost or SSH host' value='localhost'/>
		<datalist id='notebook-hosts'>
			<option value='localhost'>
		</datalist>

		Notebook <input type='text' id='notebook-name' list='notebook-names' placeholder='Name of a notebook' value='default'/>
		<datalist id='notebook-names'>
			<!-- FIXME load list automatically -->
			<option value='default'>
			<option value='systemd'>
		</datalist>
	</div>

	<div class='main' id='settings'>
		<h2>Refresh Interval</h2>

		<p>How often WurmTerm will look for new or disconnected hosts.</p>

		<input type="number" size="6" step="5" id="refreshInterval" name="refreshInterval" min="5">
		Seconds (min 5s)

		<h2>Active Probes</h2>

		<p>Control which probes you want to run. Toggle their status by clicking.</p>

		Enabled:
                <div class="settingsBox" id="probesEnabled"></div>
		Disabled:
                <div class="settingsBox" id="probesDisabled"></div>

		<h2>Backend Endpoint</h2>

		<input type="text" id="backendEndpoint" size="80">

		<p>Websocket endpoint of the WurmTerm backend (e.g. ws://localhost:8181). Please refresh the page after changing this value!</p>
	</div>

	<script type="module">
		import { setupApp } from './js/app.js';
		import './node_modules/jquery/dist/jquery.min.js';

		/**
		 * Workaround for the "Automatic publicPath is not supported in this browser" fail
		 *
		 * See https://github.com/cypress-io/cypress/issues/18435 for more
		 * details. Should be removed when cypress switches to webpack 5.
		 */
		var scripts = document.getElementsByTagName("script");
		scripts[scripts.length - 1].src = ' ';  // yes, thats a single space and not the empty string

		(async function() {
			'use strict';

			let response = await fetch("/notebooks/default.md");
			window.initialNotebookContent = await response.text();			

			/* Async module load to ensure above webpack workaround is done 
			   and we have loaded the initial notebook markdown */
			await import('./node_modules/starboard-notebook/dist/starboard-notebook.js');
			setupApp();
		})();
	</script>
</body>
</html>
